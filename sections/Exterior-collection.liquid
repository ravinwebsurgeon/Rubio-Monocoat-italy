{% assign source_collection = collections[section.settings.source_collection] %}
{% assign tab_images = source_collection.metafields.custom.species_images.value %}
{% assign tab_titles = source_collection.metafields.custom.species_titles.value %}
{% assign exterior_vertical_tags = source_collection.metafields.custom.species_vertical_tag_name.value %}
{% assign exterior_horizontal_tags = source_collection.metafields.custom.species_tag_name.value %}

<div class="circle-tabs-section exteriour_tabs_section">             
  <div class="circle-tabs-outer exterior">
    {% if section.settings.heading2 != blank %}
      <h3 class="tabs-heading heading-pr">{{ section.settings.heading2 }}</h3>
    {% endif %}
    <div class="circle-tabs">
      {% comment %} {% for block in section.blocks %}
        <button class="circle-tab" data-tab="tab-{{ block.id }}"
           data-exterior-v-tag-name="{{ block.settings.exterior_v_tag_name }}" 
           data-exterior-tag-name="{{ block.settings.exterior_tag_name }}" 
        >
           {% if block.settings.tab_image %}
            <span class="circle-tab-ing"> 
              <img src="{{ block.settings.tab_image | img_url: '200x200' }}" alt="{{ block.settings.tab_name | escape }}" width="" height=""> 
            </span>
          {% endif %}
          <span>{{ block.settings.tab_name }}</span>
        </button>
      {% endfor %} {% endcomment %}
         
       {% for image in tab_images %}
      {% assign index = forloop.index0 %}
      {% assign title = tab_titles[index] %}
      {% assign v_tag = exterior_vertical_tags[index] %}
      {% assign h_tag = exterior_horizontal_tags[index] %}

      <button 
        class="circle-tab"
        data-tab="tab-{{ forloop.index0 }}"
        data-exterior-v-tag-name="{{ v_tag | escape }}"
        data-exterior-tag-name="{{ h_tag | escape }}"
      >
        {% if image != blank %}
          <span class="circle-tab-img">
            <img 
              src="{{ image | img_url: '200x200' }}" 
              alt="{{ title | escape }}" 
              width="200" height="200"
            >
          </span>
        {% endif %}
        <span>{{ title }}</span>
      </button>
    {% endfor %}

    </div>
  </div> 
    <!-- Filter bar with slider -->
          <div class="filter-bar-exterior">
  <div class="filter-left-exterior">
    <div class="filttter1-exterior">
      <button class="icon-btn-exterior color-ic-exterior">                
        <!-- SVG content remains same -->
      </button>
      <button class="icon-btn-exterior img-ic-exterior">                
        <!-- SVG content remains same -->
      </button>
    </div>
    <div class="filttter2-exterior">
      <div class="range-input-section-exterior slider-wrap-exterior">
        <button class="range-button-exterior base-button type-button size-small theme-primary">
          <!-- SVG minus icon -->
        </button> 
        <input id="gridLayoutExterior" type="range" name="gridLayoutExterior" min="0" max="2" step="1" value="1"> 
        <button class="range-button-exterior base-button type-button size-small theme-primary">
          <!-- SVG plus icon -->
        </button>
      </div>
    </div>
    <label class="avail-toggle-exterior">
      <input type="checkbox" id="available-filter-exterior">
      <span>Available in Samples</span>
    </label>
    <div class="filter-wrap-exterior">
      <button class="icon-btn-exterior filter-exterior" id="filterByBtnExterior">                
        <!-- SVG filter icon -->
        <span>Filter by</span>
      </button>
    </div>                
  </div>
  <button class="tips-link-exterior" id="openVideoExterior">
    <span class="play-exterior">                
      <!-- SVG play icon -->
    </span>
    <span class="tips-link-txt-exterior"> Not sure which colour to choose? Check out our expert tips! </span>
    <span class="tips-link-txt-exterior tips-link-mobs-exterior"> Check out our expert tips! </span>
  </button>
</div>

<!-- Filters Panel for Exterior -->
<div id="filtersPanelExterior" class="filters-panel-exterior" style="display: none;">
  <div class="fil-color-outers-exterior">
    <div class="filter-buttons-exterior">
      <button class="filter-btn-exterior active" data-target="colour-options-exterior">Colour</button>
      <button class="filter-btn-exterior" data-target="product-options-exterior">Product</button>
    </div>

    <div class="filter-options-container-exterior">
      <div id="colour-options-exterior" class="filter-options-exterior">
        <!-- Colour options content -->
      </div>

      <div id="product-options-exterior" class="filter-options-exterior" style="display: none;">
        <!-- Product options content -->
      </div>
    </div>

    <button id="clearFiltersExterior" class="button clear-all-exterior">Clear All</button>
  </div>
</div>
</div> 
<div class="tab-products-wrap Exterior-wrap">
  {% if section.settings.heading != blank %}
    <h4 class="oil-head">{{ section.settings.heading }}</h4>
  {% endif %}

  {% assign tab_collection = collections[section.settings.exterior_collection] %}

  {% if tab_collection != blank %}
    <div class="tab-productss active">
      <ul class="product-grid collection-{{ tab_collection.handle }}">
        {% for product in tab_collection.products %}
          {% assign ash_image = product.metafields.custom.exterior_ash_image.value %}
          {% assign beech_image = product.metafields.custom.exterior_beech_image.value %}
          {% assign larch_image = product.metafields.custom.exterior_larch_image.value %}
          {% assign pine_image = product.metafields.custom.exterior_pine_image.value %}
          {% assign oak_image = product.metafields.custom.exterior_oak_image.value %}
          {% assign maple_image = product.metafields.custom.exterior_maple_image.value %}   
          <li class="product-item"
              data-colours="{{ product.metafields.custom.colour_filter2.value | join: ',' }}"
              data-products="{{ product.metafields.custom.product_filter.value | join: ',' }}"
              data-available="{{ product.available }}"
              data-product-id="{{ product.variants.first.id }}"
              data-tags="{{ product.tags | join: ',' }}">
            
            <div class="product-item-img-col">
              <a href="{{ product.url }}">
                {% if product.featured_image %}
                  <div class="product-image-wrapper"
                       data-cover="{{ product.metafields.custom.cover_image | img_url: 'master' }}"
                       data-featured="{{ product.featured_image | img_url: '400x' }}"
                       data-ash="{% if ash_image %}{{ ash_image | img_url: '400x'}} {%endif %}"
                        data-beech="{% if beech_image %}{{ beech_image | img_url: '400x'}} {%endif %}"
                        data-larch="{% if larch_image %}{{ larch_image | img_url: '400x'}} {%endif %}"
                        data-pine="{% if pine_image %}{{ pine_image | img_url: '400x'}} {%endif %}"
                        data-oak="{% if oak_image %}{{ oak_image | img_url: '400x'}} {%endif %}"
                        data-maple="{% if maple_image %}{{ maple_image | img_url: '400x'}} {%endif %}"   
                  >
                    {% if product.metafields.custom.cover_image != blank %}
                      <img class="cover-image" src="{{ product.metafields.custom.cover_image | img_url: 'master' }}" alt="{{ product.title }}">
                    {% endif %}
                    <img class="featured-image" src="{{ product.featured_image | img_url: 'master' }}" alt="{{ product.title | escape }}">
                  </div>
                {% endif %}
              </a>
              <div class="plus-show">{% render 'Cs-plus-icon' %}</div>
            </div>

            <div class="product-item-conts">
              <div class="product-buttons-wraper">
                <button class="more-info-color">More Info</button>
                <button class="order-sample-color">Order Sample</button>
              </div>
              <a href="{{ product.url }}">
                <h3>{{ product.title }}</h3>
                <p class="price hidden">{{ product.price | money }}</p>
              </a>
            </div>
          </li>
        {% endfor %}
      </ul>
    </div>
  {% else %}
    <p>No collection selected or collection is empty.</p>
  {% endif %}
</div>


{% schema %}
{
  "name": "Exterior Collection",
  "settings": [
    { "type": "text", "id": "heading", "label": "Main Heading" },
    { "type": "text", "id": "heading2", "label": "Secondary Heading", "default": "Choose your species:" },
   {
    "type": "collection",
    "id": "source_collection",
    "label": "Select Page for Images"
    },
    { "type": "collection", "id": "exterior_collection", "label": "Exterior Collection" }
  ],
   "blocks": [
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
        { "type": "text", "id": "tab_name", "label": "Species name" },
        { "type": "text", "id": "exterior_tag_name", "label": "Exterior Horizontal Tag name" },
        { "type": "text", "id": "exterior_v_tag_name", "label": "Exterior vertical Tag name" },
        { "type": "image_picker", "id": "tab_image", "label": "Tab image" },
        { "type": "collection", "id": "tab_collection", "label": "Collection to show" }
      ]
    }
  ],
  "presets": [{ "name": "Exterior Collection", "category": "Custom" }]
}
{% endschema %}

<script>
  // Exterior Section JavaScript
document.addEventListener('DOMContentLoaded', function() {
  
  // =============================================
  // FILTER BAR FUNCTIONALITY - EXTERIOR
  // =============================================
  
  const availableFilterExterior = document.getElementById('available-filter-exterior');
  const gridLayoutInputExterior = document.getElementById('gridLayoutExterior');
  const minusBtnExterior = document.querySelector('.slider-wrap-exterior .range-button-exterior:first-child');
  const plusBtnExterior = document.querySelector('.slider-wrap-exterior .range-button-exterior:last-child');
  const filterByBtnExterior = document.getElementById('filterByBtnExterior');
  const filtersPanelExterior = document.getElementById('filtersPanelExterior');
  const filterBtnsExterior = document.querySelectorAll('.filter-btn-exterior');
  const filterOptionsExterior = document.querySelectorAll('.filter-options-exterior');
  const clearBtnExterior = document.getElementById('clearFiltersExterior');
  
  // Get exterior products
  const productsExterior = document.querySelectorAll('.product-item-exterior');

  // Available samples filter
  if (availableFilterExterior) {
    availableFilterExterior.addEventListener('change', () => {
      filterProductsExterior();
    });
  }

  // Grid layout slider
  if (gridLayoutInputExterior && minusBtnExterior && plusBtnExterior) {
    updateGridLayoutExterior(parseInt(gridLayoutInputExterior.value));
   
    gridLayoutInputExterior.addEventListener('input', function() {
      updateGridLayoutExterior(parseInt(this.value));
    });
    
    minusBtnExterior.addEventListener('click', function() {
      if (parseInt(gridLayoutInputExterior.value) > 0) {
        gridLayoutInputExterior.value = parseInt(gridLayoutInputExterior.value) - 1;
        updateGridLayoutExterior(parseInt(gridLayoutInputExterior.value));
      }
    });
    
    plusBtnExterior.addEventListener('click', function() {
      if (parseInt(gridLayoutInputExterior.value) < 2) {
        gridLayoutInputExterior.value = parseInt(gridLayoutInputExterior.value) + 1;
        updateGridLayoutExterior(parseInt(gridLayoutInputExterior.value));
      }
    });
  }

  // Filters panel toggle
  if (filterByBtnExterior && filtersPanelExterior) {
    filterByBtnExterior.addEventListener('click', () => {
      const isVisible = filtersPanelExterior.style.display === 'block';
      filtersPanelExterior.style.display = isVisible ? 'none' : 'block';

      // Reset to Colour tab
      filterBtnsExterior.forEach(btn => btn.classList.remove('active'));
      if (filterBtnsExterior[0]) filterBtnsExterior[0].classList.add('active');

      filterOptionsExterior.forEach(panel => {
        panel.style.display = (panel.id === 'colour-options-exterior') ? 'flex' : 'none';
      });
    });
  }

  // Filter tabs switching
  filterBtnsExterior.forEach(btn => {
    btn.addEventListener('click', () => {
      const targetId = btn.dataset.target;
      filterBtnsExterior.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      filterOptionsExterior.forEach(panel => {
        panel.style.display = (panel.id === targetId) ? 'flex' : 'none';
      });
    });
  });

  // Filter option selection
  document.querySelectorAll('.filter-options-exterior .option-btn-exterior').forEach(option => {
    option.addEventListener('click', () => {
      const parentPanel = option.closest('.filter-options-exterior');
      parentPanel.querySelectorAll('.option-btn-exterior').forEach(btn => btn.classList.remove('active'));
      option.classList.add('active');
      
      filterProductsExterior();
    });
  });

  // Clear all filters
  if (clearBtnExterior) {
    clearBtnExterior.addEventListener('click', () => {
      // Reset filter buttons
      filterBtnsExterior.forEach(b => b.classList.remove('active'));
      if (filterBtnsExterior[0]) filterBtnsExterior[0].classList.add('active');

      // Reset filter options
      filterOptionsExterior.forEach(panel => {
        panel.style.display = (panel.id === 'colour-options-exterior') ? 'flex' : 'none';
        panel.querySelectorAll('.option-btn-exterior').forEach(btn => btn.classList.remove('active'));
      });

      // Reset available filter
      if (availableFilterExterior) availableFilterExterior.checked = false;

      // Show all products
      productsExterior.forEach(p => p.style.display = '');
    });
  }

  // Filter products function
  function filterProductsExterior() {
    const selectedColour = document.querySelector('#colour-options-exterior .option-btn-exterior.active')?.dataset.value;
    const selectedProduct = document.querySelector('#product-options-exterior .option-btn-exterior.active')?.dataset.value;
    const showOnlyAvailable = availableFilterExterior?.checked === true;

    productsExterior.forEach(product => {
      const productColours = (product.dataset.colours || '').split(',');
      const productProducts = (product.dataset.products || '').split(',');
      const productAvailable = product.dataset.available === 'true';

      const colourMatch = !selectedColour || productColours.includes(selectedColour);
      const productMatch = !selectedProduct || productProducts.includes(selectedProduct);
      const availableMatch = !showOnlyAvailable || productAvailable;

      product.style.display = (colourMatch && productMatch && availableMatch) ? '' : 'none';
    });
  }

  // Grid layout function
  function updateGridLayoutExterior(value) {
    const productGridsExterior = document.querySelectorAll('.product-grid-exterior');
    productGridsExterior.forEach(grid => {
      grid.classList.remove('cols-7', 'cols-5', 'cols-3');
     
      if (value === 0) {
        grid.classList.add('cols-7');
      } else if (value === 1) {
        grid.classList.add('cols-5');
      } else if (value === 2) {
        grid.classList.add('cols-3');
      }
    });
  }

  // Image toggle buttons
  const colorIcExterior = document.querySelector('.color-ic-exterior');
  const imgIcExterior = document.querySelector('.img-ic-exterior');

  if (colorIcExterior) {
    colorIcExterior.addEventListener('click', function() {
      document.querySelectorAll('.product-image-wrapper-exterior').forEach(function(wrapper) {
        wrapper.classList.remove('show-cover', 'show-featured');
        wrapper.dataset.defaultView = 'cover';
      });
    });
  }

  if (imgIcExterior) {
    imgIcExterior.addEventListener('click', function() {
      document.querySelectorAll('.product-image-wrapper-exterior').forEach(function(wrapper) {
        wrapper.classList.remove('show-cover', 'show-featured');
        wrapper.dataset.defaultView = 'featured';
      });
    });
  }

  // Set initial default view
  document.querySelectorAll('.product-image-wrapper-exterior').forEach(function(wrapper) {
    wrapper.dataset.defaultView = 'cover';
  });

  // =============================================
  // CIRCLE TABS FUNCTIONALITY - EXTERIOR
  // =============================================
  
  const circleTabsExterior = document.querySelectorAll('.circle-tab-exterior');
  
  if (circleTabsExterior.length) {
    function showproductsExterior() {
      const productsExterior = document.querySelectorAll('.product-item-exterior');
      const activeTabExterior = document.querySelector('.circle-tab-exterior.active');
      const surfaceItemExterior = document.querySelector('.surface-item.active');
   
      let surface = '';
      if (surfaceItemExterior?.classList.contains('vertical')) {
        surface = 'vertical';
      } else if (surfaceItemExterior?.classList.contains('horizontal')) {
        surface = 'horizontal';
      }
   
      const showOnlyAvailable = availableFilterExterior?.checked === true;
   
      let selectedTags = [];
   
      if (activeTabExterior) {
        let exteriorMainTag = activeTabExterior.dataset.exteriorTagName?.trim().toLowerCase() || '';
        let exteriorVerticalTag = activeTabExterior.dataset.exteriorVTagName?.trim().toLowerCase() || '';
 
        if (surface === 'vertical') {
          selectedTags = [exteriorVerticalTag].filter(Boolean);
        } else {
          selectedTags = [exteriorMainTag].filter(Boolean);
        }
      }
   
      productsExterior.forEach(product => {
        const productTags = product.dataset.tags
          ?.split(',')
          .map(tag => tag.trim().toLowerCase()) || [];
 
        const hasMatchingTag = selectedTags.length > 0
          ? selectedTags.some(tag => productTags.includes(tag))
          : true;
 
        const isAvailable = product.dataset.available === 'true' || product.dataset.available === true;
 
        let shouldShow = false;
 
        if (!activeTabExterior) {
          shouldShow = !showOnlyAvailable || isAvailable;
        } else {
          shouldShow = hasMatchingTag && (!showOnlyAvailable || isAvailable);
        }
        
        if (shouldShow) {
          const imgWrapper = product.querySelector('.product-image-wrapper-exterior');
          const activeTabText = activeTabExterior?.textContent?.trim().toLowerCase();
 
          if (imgWrapper && activeTabText) {
            const image = imgWrapper?.dataset[activeTabText];
            if (image) {
              const featImg = imgWrapper.querySelector('img.featured-image-exterior');
              if (featImg) featImg.src = image;
            }
          }
          product.style.display = 'block';
        } else {
          product.style.display = 'none';
        }
      });
    }
 
    // Circle tab click handler
    circleTabsExterior.forEach(btn => {
      btn.addEventListener('click', e => {
        const target = e.currentTarget;
 
        document.querySelectorAll('.circle-tab-exterior.active').forEach(el => {
          el.classList.remove('active');
        });
 
        target.classList.add('active');
        document.getElementById(target.dataset.tab)?.classList.add('active');
 
        showproductsExterior();
      });
    });
 
    // Available samples checkbox handler
    if (availableFilterExterior) {
      availableFilterExterior.addEventListener('change', () => {
        showproductsExterior();
      });
    }
 
    // Run once on load
    showproductsExterior();
  }

  // =============================================
  // PRODUCT INTERACTIONS - EXTERIOR
  // =============================================
  
  // Quick View Modal for Exterior
  const modalExterior = document.getElementById('quickViewModal');
  const modalImageExterior = document.getElementById('quickViewImage');
  const modalTitleExterior = document.getElementById('quickViewTitle');
  const modalPriceExterior = document.getElementById('quickViewPrice');
  const modalMetaExterior = document.getElementById('quickViewMeta');
  const modalLinkExterior = document.getElementById('quickViewLink');
  const closeBtnExterior = modalExterior?.querySelector('.close-quick-view');
  const qtyInputExterior = document.getElementById('quickViewQty');
  const addToCartBtnExterior = document.getElementById('quickViewAddToCart');

  let currentProductIdExterior = null;

  document.querySelectorAll('.plus-show-exterior').forEach(button => {
    button.addEventListener('click', function() {
      const product = button.closest('.product-item-exterior');
      const featuredImg = product.querySelector('.featured-image-exterior').src;
      const title = product.querySelector('h3').innerText;
      const price = product.querySelector('.price').innerText;
      const colours = product.dataset.colours || '';
      const products = product.dataset.products || '';
      const url = product.querySelector('a').href;

      currentProductIdExterior = product.dataset.productId;

      modalImageExterior.src = featuredImg;
      modalTitleExterior.textContent = title;
      modalPriceExterior.textContent = price;
      modalMetaExterior.textContent = `Colours: ${colours} | Types: ${products}`;
      modalLinkExterior.href = url;
      qtyInputExterior.value = 1;

      modalExterior.style.display = 'flex';
    });
  });

  // Order Sample Button for Exterior
  document.querySelectorAll(".order-sample-color-exterior").forEach((button) => {
    button.addEventListener("click", function (e) {
      e.preventDefault();

      const productItem = this.closest(".product-item-exterior");
      const variantId = productItem.dataset.productId;

      if (!variantId) {
        console.error("No variant ID found for this product.");
        return;
      }

      fetch("/cart/add.js", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          id: variantId,
          quantity: 1,
        }),
      })
        .then((res) => res.json())
        .then((data) => {
          console.log("Added to cart:", data);
          updateCartBubble();
          openCartDrawer();
        })
        .catch((err) => console.error("Error adding to cart:", err));
    });
  });

  // More Info Button for Exterior
  document.querySelectorAll(".more-info-color-exterior").forEach((button) => {
    button.addEventListener("click", function (e) {
      e.preventDefault();

      const productItem = this.closest(".product-item-exterior");
      const productLink = productItem.querySelector("a[href]");
      if (productLink) window.location.href = productLink.href;
    });
  });

  // =============================================
  // VIDEO MODAL - EXTERIOR
  // =============================================
  
  const openBtnExterior = document.getElementById('openVideoExterior');
  const modalVideoExterior = document.getElementById('videoModal');
  const closeBtnVideoExterior = document.getElementById('closeVideo');
  const videoExterior = document.getElementById('expertVideo');

  if (openBtnExterior && modalVideoExterior && closeBtnVideoExterior && videoExterior) {
    openBtnExterior.addEventListener('click', () => {
      modalVideoExterior.classList.add('active');
      videoExterior.currentTime = 0;
      videoExterior.play();
    });
  }

  // =============================================
  // SURFACE TOGGLE FUNCTIONALITY
  // =============================================
  
  const exteriorToggle = document.querySelector(".exterior.surface-toggle");
  const surfaceOptions = document.getElementById("exterior-surfaces");

  if (exteriorToggle && surfaceOptions) {
    exteriorToggle.addEventListener("click", function(e) {
      e.stopPropagation();
      const isActive = this.classList.contains("active");

      document.querySelectorAll(".surface-options").forEach(opt => opt.style.display = "none");
      document.querySelectorAll(".surface-toggle").forEach(el => el.classList.remove("active"));

      if (!isActive) {
        surfaceOptions.style.display = "flex";
        this.classList.add("active");
      }
    });

    // Handle surface item selection
    const surfaceItems = surfaceOptions.querySelectorAll(".surface-item");
    surfaceItems.forEach(item => {
      item.addEventListener("click", function(e) {
        e.stopPropagation();
        surfaceItems.forEach(i => i.classList.remove("active"));
        this.classList.add("active");
        showproductsExterior(); // Refresh products when surface changes
      });
    });

    // Hide when clicking outside
    document.addEventListener("click", function(e) {
      if (!exteriorToggle.contains(e.target) && !surfaceOptions.contains(e.target)) {
        surfaceOptions.style.display = "none";
        exteriorToggle.classList.remove("active");
      }
    });
  }

  // =============================================
  // SECTION TOGGLE FUNCTIONALITY
  // =============================================
  
  const circleTabsOuterExterior = document.querySelector(".circle-tabs-outer.exterior");
  const filterBarExterior = document.querySelector(".filter-bar-exterior");
  const tabProductsExterior = document.querySelector(".tab-products-wrap-exterior");
  const interiorBtn = document.querySelector(".Interio");

  // Hide all by default
  circleTabsOuterExterior?.classList.remove("show-section");
  filterBarExterior?.classList.remove("show-section");
  tabProductsExterior?.classList.remove("show-section");

  // EXTERIOR CLICK → toggle dropdown
  exteriorToggle?.addEventListener("click", function(e) {
    e.stopPropagation();
    const isActive = this.classList.contains("active");

    document.querySelectorAll(".surface-options").forEach(opt => opt.style.display = "none");
    document.querySelectorAll(".surface-toggle").forEach(el => el.classList.remove("active"));

    if (!isActive) {
      surfaceOptions?.style.setProperty("display", "flex");
      this.classList.add("active");
    }

    // Remove active from Interior
    interiorBtn?.classList.remove("active");

    // Hide circle tabs + filter until a surface is selected
    circleTabsOuterExterior?.classList.remove("show-section");
    filterBarExterior?.classList.remove("show-section");
    tabProductsExterior?.classList.remove("show-section");

    // Remove active from circle tabs
    document.querySelectorAll('.circle-tab-exterior').forEach(t => t.classList.remove("active"));
  });

  // SURFACE ITEM CLICK → show tabs + filter only
  surfaceOptions?.querySelectorAll(".surface-item").forEach(item => {
    item.addEventListener("click", function(e) {
      e.stopPropagation();

      surfaceOptions.querySelectorAll(".surface-item").forEach(i => i.classList.remove("active"));
      this.classList.add("active");

      // Show tabs + filter
      circleTabsOuterExterior?.classList.add("show-section");
      filterBarExterior?.classList.add("show-section");

      // Hide product wrappers until a circle tab is clicked
      tabProductsExterior?.classList.remove("show-section");

      // Keep exterior dropdown open
      surfaceOptions.style.display = "flex";
      exteriorToggle.classList.add("active");

      // Remove active from circle tabs
      document.querySelectorAll('.circle-tab-exterior').forEach(t => t.classList.remove("active"));
    });
  });
   
  // CIRCLE TAB CLICK → show correct product wrapper
  document.querySelectorAll('.circle-tab-exterior').forEach(tab => {
    tab.addEventListener("click", function(e) {
      e.stopPropagation();

      document.querySelectorAll('.circle-tab-exterior').forEach(t => t.classList.remove("active"));
      this.classList.add("active");

      if (surfaceOptions?.querySelector(".surface-item.active")) {
        tabProductsExterior?.classList.add("show-section");
      }
    });
  });

  // Helper functions
  function updateCartBubble() {
    const cartBubble = document.querySelector('[data-cart-count-bubble], .cart-count-bubble');
    fetch("/cart.js")
      .then((res) => res.json())
      .then((cart) => {
        if (cartBubble) {
          cartBubble.textContent = cart.item_count;
          if (cart.item_count > 0) {
            cartBubble.classList.remove("hidden");
          } else {
            cartBubble.classList.add("hidden");
          }
        }
      })
      .catch((error) => console.error("Cart bubble update failed:", error));
  }

  function openCartDrawer() {
    const cartDrawer = document.querySelector("cart-drawer");
    fetch("/?sections=cart-drawer")
      .then((response) => response.json())
      .then((sections) => {
        const html = sections["cart-drawer"];
        if (cartDrawer && html) {
          const parsed = new DOMParser()
            .parseFromString(html, "text/html")
            .querySelector("cart-drawer");

          cartDrawer.innerHTML = parsed.innerHTML;
          cartDrawer.classList.remove("is-empty");
          cartDrawer.classList.add("is-open", "active", "animate");
          document.body.classList.add("overflow-hidden");
        }
      })
      .catch((error) => console.error("Drawer update failed:", error));
  }
});
</script>
