{% if collection.metafields.custom.how_to_use_faq_question.value != blank and collection.metafields.custom.how_to_use_faq_answer.value != blank %}
<div class="faq-main-container">
  <div class="custom-faq-wrapper">
    <div class="custom-faq-inner">

      <!-- Left Image -->
      <div class="cust-image-faq">
        <div class="custom-faq-image">
          {% assign default_image = collection.metafields.custom.how_to_use_faq_image1 %}
          {% assign default_video = collection.metafields.custom.how_to_use_faq_video1.value %}
          {% if default_image %}
            <img id="faq-left-image" src="{{ default_image | img_url: '800x' }}" alt="How to use" loading="lazy">
          {% else %}
           {{ default_video | video_tag: controls: true, autoplay: true  }}
          {% endif %}

        </div>
      </div>

      <!-- Right FAQ Accordion -->
      <div class="cust-faq-content" id="how-to-apply">
        <div class="custom-faq-section">
          {% assign faq_questions = collection.metafields.custom.how_to_use_faq_question.value %}
          {% assign faq_answers = collection.metafields.custom.how_to_use_faq_answer.value %}

          {% if faq_questions and faq_answers %}
            {% for question in faq_questions %}
              {% assign answer = faq_answers[forloop.index0] %}

              {% comment %} Assign corresponding image based on FAQ index {% endcomment %}
              {% assign image = blank %}
              {% if forloop.index0 == 0 %} {% assign image = collection.metafields.custom.how_to_use_faq_image1 %} {% endif %}
              {% if forloop.index0 == 1 %} {% assign image = collection.metafields.custom.how_to_use_faq_image2 %} {% endif %}
              {% if forloop.index0 == 2 %} {% assign image = collection.metafields.custom.how_to_use_faq_image3 %} {% endif %}
              {% if forloop.index0 == 3 %} {% assign image = collection.metafields.custom.how_to_use_faq_image4 %} {% endif %}

              {% assign video = blank %}
              {% if forloop.index0 == 0 %} {% assign video = collection.metafields.custom.how_to_use_faq_video1 %} {% endif %}
              {% if forloop.index0 == 1 %} {% assign video = collection.metafields.custom.how_to_use_faq_video2 %} {% endif %}
              {% if forloop.index0 == 2 %} {% assign video = collection.metafields.custom.how_to_use_faq_video3 %} {% endif %}
              {% if forloop.index0 == 3 %} {% assign video = collection.metafields.custom.how_to_use_faq_video4 %} {% endif %}

              <div class="custom-faq-item {% if forloop.first %}active{% endif %}" 
                data-image="{{ image | img_url: '800x' }}"
               data-video="{% if video %}{{ video | file_url }}{% endif %}"
              >
                <button type="button" class="custom-faq-question">
                  <h3>{{ question }}</h3>
                  <span class="custom-faq-icon">
                    <svg class="arrow" width="20" height="20" viewBox="0 0 24 24" fill="none"
                      xmlns="http://www.w3.org/2000/svg">
                      <path d="M6 9l6 6 6-6" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </span>
                </button>

                <div class="custom-faq-answer" style="{% if forloop.first %}display:block{% else %}display:none{% endif %}">
                  <p>{{ answer }}</p>
                </div>
              </div>
            {% endfor %}
          {% endif %}
        </div>
      </div>

    </div>
  </div>
</div>
{% endif %}
<style>
.custom-faq-image video{width:100%;}

.faq-main-container { background: #396948; }
.custom-faq-wrapper { max-width: 1745px; margin: 0 auto; padding: 100px 30px; }
.custom-faq-inner { display: flex; gap: 150px; align-items: center; }
.custom-faq-image img { max-width: 100%; border-radius: 10px; }
.custom-faq-section { flex: 1; }
.custom-faq-item { border-bottom: 1px solid #fff; padding: 10px 0; }
.custom-faq-question { width: 100%; text-align: left; font-weight: bold; background: none; border: none; cursor: pointer; padding: 10px 0; display: flex; justify-content: space-between; align-items: center; color:#fff; }
.custom-faq-icon svg { transition: transform 0.3s ease; }
.arrow-up { display: none; }
.custom-faq-answer { display: none; color:#fff; margin-top: 10px; }
.custom-faq-item h3 {
    margin: 0;
    font-family: Frutiger Neue LT W1G;
    font-weight: 700;
    font-size: 20px;
    line-height: 25px;
    text-align: center;
    color: #183029;
    background-color: #fff;
    padding: 15px 30px;
    border-radius: 50px;
}
.custom-faq-wrapper .custom-faq-inner .custom-faq-item:last-child {
    border: none;
}

@media(max-width: 1900px) { 
  .custom-faq-wrapper {
      max-width: 1745px;
      margin: 0 auto;
      padding: 50px 30px;
  }
  .custom-faq-wrapper .custom-faq-image {
    padding-bottom: 550px;
  }
  .custom-faq-item h3 {
    font-size: 14.5px;
    padding: 12px 22px;
  }
  .custom-faq-wrapper .custom-faq-inner .custom-faq-answer p {
      font-size: 16px;
      line-height: 1.5;
  }
  .custom-faq-wrapper .cust-faq-content {
      padding: 0 0 0 30px;
  }
  .custom-faq-wrapper .custom-faq-inner {
       gap: 20px;
  }
  
}

@media(max-width: 991px) { 
  .custom-faq-inner { 
    flex-direction: column; 
  } 
  .custom-faq-wrapper {
    padding: 50px 20px;
  }
}
@media(max-width: 767px) { 
  .custom-faq-wrapper {
      padding: 30px 20px;
  }
  .custom-faq-wrapper .custom-faq-image {
      padding-bottom: 0;
  }
  .custom-faq-wrapper .custom-faq-image img {
    position: static;
  }
   .custom-faq-item h3 {
    font-size: 14px;
    padding: 5.5px 14.5px;
  }
  .custom-faq-wrapper .custom-faq-inner .custom-faq-answer p {
    font-size: 12px;
  }
  .custom-faq-wrapper .custom-faq-inner .custom-faq-item {
      padding: 15px 0;
  }
}

</style>

{% comment %} 
<script>
$(document).ready(function() {
  $(".custom-faq-question").on("click", function() {
    var $item = $(this).closest(".custom-faq-item");
    var $answer = $item.find(".custom-faq-answer");

    if ($item.hasClass("active")) {
      $item.removeClass("active");
      $answer.slideUp(300);
    } else {
      // Close all other items
      $(".custom-faq-item").removeClass("active").find(".custom-faq-answer").slideUp(300);

      // Open clicked
      $item.addClass("active");
      $answer.slideDown(300);

      // Change left image
      var newImage = $item.data("image");
      if (newImage) {
        $("#faq-left-image").attr("src", newImage);
      }
    }
  });
});
</script> {% endcomment %}

<script>
$(document).ready(function() {
  $(".custom-faq-question").on("click", function() {
    var $item = $(this).closest(".custom-faq-item");
    var $answer = $item.find(".custom-faq-answer");
    if ($item.hasClass("active")) {
      $item.removeClass("active");
      $answer.slideUp(300);
    } else {
      $(".custom-faq-item").removeClass("active").find(".custom-faq-answer").slideUp(300);
      $item.addClass("active");
      $answer.slideDown(300);

      // Update left media (image or video)
      var newVideo = $item.data("video");
      var newImage = $item.data("image");
      var $mediaContainer = $(".custom-faq-image");
      console.log(newVideo,'video')
      console.log(newImage,'image')
      console.log($mediaContainer,'mediaContainer')

        // inside your click handler, after determining newVideo/newImage and $mediaContainer:
      $mediaContainer.fadeOut(100, function() {
        // this callback 'this' is the DOM element; but use jQuery methods for consistency
        $mediaContainer.empty(); // correct way to clear jQuery object content

        // Prefer video if available (change order if you want image priority)
        if (newVideo && newVideo !== "null" && newVideo !== "") {
          // append video element
          {% comment %} $mediaContainer.classList.add('video__media') {% endcomment %}
          $mediaContainer.html(
            `<video controls autoplay muted loop playsinline style="width:100%;border-radius:10px;">
              <source src="${newVideo}" type="video/mp4">
            </video>`
          );
          console.log('video inserted:', newVideo);
        } else if (newImage && newImage !== "null" && newImage !== "") {
          // append image
          {% comment %} $mediaContainer.classList.add('image__media') {% endcomment %}
          $mediaContainer.html(
            `<img src="${newImage}" alt="How to use" loading="lazy" style="border-radius:10px;width:100%;">`
          );
          console.log('image inserted:', newImage);
        }

        $mediaContainer.fadeIn(100);
      });
    }
  });
});
</script>

{% schema %} 
{
  "name": "How To Use cat FAQ",
  "tag": "section",
  "class": "faq-main-container",
  "presets": [
    {
      "name": "How To Use cat FAQ",
      "category": "Custom"
    }
  ]
}
{% endschema %}
