<section class="inspired-collage">
  <div class="collage-header">
    <h2>{{ section.settings.heading }}</h2>
    <p>{{ section.settings.subheading }}</p>
  </div>

  <div class="collage-grid">
    {% for block in section.blocks %}
      {% assign product = block.settings.product %}
      {% if product %}
        <div class="collage-item {% if forloop.first %}large{% else %}small{% endif %}" style="background-image: url('{{ block.settings.background_image | img_url: 'master' }}')">
          <a href="javascript:void(0);" class="product-overlay-btn" data-product-handle="{{ product.handle }}">
            <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="20" cy="20" r="20" fill="black" fill-opacity="0.5"/>
              <circle cx="20" cy="20" r="9" fill="white"/>
            </svg>
          </a>
        </div>
      {% endif %}
    {% endfor %}
  </div>
</section>

<!-- Popup modal -->
<div class="product-popup" id="product-popup">
  <div class="popup-content">
    <span class="close-popup">&times;</span>
    <div id="popup-product-content"></div>
  </div>
</div>

<style>
.inspired-collage { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
.collage-header h2 { font-size: 32px; margin-bottom: 10px; }
.collage-header p { font-size: 16px; color: #666; }

.collage-grid { display: flex; flex-wrap: wrap; gap: 10px; }
.collage-item { position: relative; overflow: hidden; border-radius: 12px; cursor: pointer; background-size: cover; background-position: center; }
.collage-item.large { flex: 1 1 45%; height: 825px; }
.collage-item.small { flex: 1 1 27%; height: 400px; }
.product-overlay-btn { position: absolute; top: 10px; left: 10px; z-index: 10; }

.product-popup { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000; }
.popup-content { background: #fff; padding: 20px; border-radius: 12px; max-width: 600px; width: 100%; position: relative; }
.close-popup { position: absolute; top: 10px; right: 10px; font-size: 24px; cursor: pointer; }
</style>

<script>
document.addEventListener("DOMContentLoaded", function(){
  const buttons = document.querySelectorAll(".product-overlay-btn");
  const popup = document.getElementById("product-popup");
  const popupContent = document.getElementById("popup-product-content");
  const closeBtn = document.querySelector(".close-popup");

  buttons.forEach(btn => {
    btn.addEventListener("click", function(){
      const handle = this.dataset.productHandle;
      fetch(`/products/${handle}.js`)
        .then(res => res.json())
        .then(product => {
          popupContent.innerHTML = `
            <h3>${product.title}</h3>
            <img src="${product.images[0]}" style="width:100%;border-radius:12px;margin-bottom:15px;">
            <p>${product.body_html}</p>
            <form action="/cart/add" method="post">
              <select name="id" style="width:100%;margin-bottom:10px;padding:8px;">
                ${product.variants.map(v => `<option value="${v.id}">${v.title} - $${(v.price/100).toFixed(2)}</option>`).join('')}
              </select>
              <button type="submit" style="padding:10px 15px;background:#183029;color:#fff;border:none;border-radius:6px;cursor:pointer;">Add to Cart</button>
            </form>
          `;
          popup.style.display = "flex";
        }).catch(err => console.error(err));
    });
  });

  closeBtn.addEventListener("click", () => popup.style.display = "none");
  popup.addEventListener("click", e => { if(e.target === popup) popup.style.display = "none"; });
});
</script>


{% schema %}
{
  "name": "Inspired Wooden Floors",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Get inspired by wooden floors" },
    { "type": "text", "id": "subheading", "label": "Subheading", "default": "Create a bedroom worth staying awake for with these inspiring ideas." }
  ],
  "blocks": [
    {
      "type": "product_block",
      "name": "Product",
      "settings": [
        { "type": "product", "id": "product", "label": "Select Product" },
        { "type": "image_picker", "id": "background_image", "label": "Background Image" }
      ]
    }
  ],
  "presets": [
    { "name": "Inspired Wooden Floors", "category": "Sections", "blocks": [ { "type": "product_block" } ] }
  ]
}
{% endschema %}
