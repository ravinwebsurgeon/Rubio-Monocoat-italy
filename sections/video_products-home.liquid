<section 
  class="video-products-section"
  style="
    --section-bg: {{ section.settings.section_background_color | default: '#f5f5f5' }};
    --heading-color: {{ section.settings.heading_color | default: '#000000' }};
    --heading-size: {{ section.settings.heading_font_size | default: 36 }}px;
    --video-radius: {{ section.settings.video_border_radius | default: 12 }}px;
    --view-btn-bg: {{ section.settings.view_button_bg_color | default: '#000000' }};
    --view-btn-color: {{ section.settings.view_button_text_color | default: '#ffffff' }};
    --view-btn-size: {{ section.settings.view_button_font_size | default: 16 }}px;
    --view-btn-radius: {{ section.settings.view_button_border_radius | default: 8 }}px;
  "
>
  <div class="container" data-aos="fade-up">
    <h2 class="video-heading" style="color: var(--heading-color); font-size: var(--heading-size);">{{ section.settings.heading }}</h2>
    <div class="video-wrapper">
      <div class="video-container" style="border-radius: var(--video-radius);">
        <video autoplay muted loop playsinline class="video-bg" style="border-radius: var(--video-radius);">
          <source src="{{ section.settings.video_url }}" type="video/mp4">
          Your browser does not support the video tag.
        </video>

        <div class="product-overlay">
          <div class="product-slider">
            <div class="product-track">
              {% for block in section.blocks %}
                {% if block.settings.product %}
                  {% assign product = all_products[block.settings.product] %}
                  {% if product %}
                    <div class="product-card" style="background: {{ block.settings.product_card_bg_color | default: '#ffffff' }}; border-radius: {{ block.settings.product_card_border_radius | default: 20 }}px;">
                      <div class="product-image">
                        <img src="{{ product.featured_image | img_url: '150x' }}" alt="{{ product.title }}">
                      </div>
                      <div class="product-info">
                        <div class="stars">★★★★★</div>
                        <h4 style="color: {{ block.settings.product_title_color | default: '#000000' }}; font-size: {{ block.settings.product_title_font_size | default: 20 }}px;">
                          {{ product.title }}
                        </h4>
                        <p class="price" style="color: {{ block.settings.price_color | default: '#f5f5f5' }}; font-size: {{ block.settings.price_font_size | default: 14 }}px;">
                          {{ product.price | money }}
                        </p>
                      </div>
                      <div class="product-icons">
                        {% if block.settings.icon_1 %}
                          <a href="{{ block.settings.icon_1_link }}" class="add-to-cart-btn" data-variant-id="{{ product.selected_or_first_available_variant.id }}">
                            <img src="{{ block.settings.icon_1 | img_url: '40x' }}" alt="Add to Cart">
                          </a>
                        {% endif %}
                        {% if block.settings.icon_2 %}
                          <a href="{{ block.settings.icon_2_link }}" class="slide-next-btn gg-{{ forloop.index }}">
                            <img src="{{ block.settings.icon_2 | img_url: '40x' }}" alt="Next Products">
                          </a>
                        {% endif %}
                      </div>
                    </div>
                  {% endif %}
                {% endif %}
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>

    {% if section.settings.button_link %}
      <a href="{{ section.settings.button_link }}" class="view-button home-video-btn" 
         style="background-color: var(--view-btn-bg); color: var(--view-btn-color); font-size: var(--view-btn-size); border-radius: var(--view-btn-radius); padding: 10px 20px; text-decoration: none; display: inline-block;">
        {{ section.settings.button_label }}
      </a>
    {% endif %}
  </div>
</section>
<script>
$(document).ready(function () {
  function setCartBubble(count) {
    var $icon = $("#cart-icon-bubble");
    if (!$icon.length) return;
    var $bubble = $icon.find(".cart-count-bubble");

    if (count > 0) {
      if (!$bubble.length) {
        $bubble = $('<div class="cart-count-bubble" aria-live="polite"></div>').appendTo($icon);
      }
      $bubble.html(
        '<span aria-hidden="true">' + count + '</span>' +
        '<span class="visually-hidden">' + count + ' item' + (count > 1 ? 's' : '') + '</span>'
      ).show();
    } else {
      $bubble.remove();
    }
  }

  // Check cart every 2 seconds
  setInterval(function () {
    $.getJSON("/cart.js", function (cart) {
      setCartBubble(cart.item_count);
    });
  }, 2000);

  // Add to cart click handler
  $(".add-to-cart-btn").on("click", function (e) {
    e.preventDefault();
    var variantId = $(this).data("variant-id");
    if (!variantId) return console.error("Variant ID missing");

    $.ajax({
      type: "POST",
      url: "/cart/add.js",
      data: { id: variantId, quantity: 1 },
      dataType: "json",
      success: function () {
        $.get("/?section_id=cart-drawer", function (data) {
          var $drawer = $("cart-drawer");
          var newDrawerHtml = $(data).find("cart-drawer").html();
          var newDrawerClass = $(data).find("cart-drawer").attr("class") || "drawer animate";
          $drawer.html(newDrawerHtml);
          $drawer.attr("class", newDrawerClass.replace("is-empty", "").trim()).addClass("active");
        });
      },
      error: function (err) {
        console.error("Error adding to cart:", err);
      }
    });
  });

  // Close drawer on overlay click
  $(document).on("click", ".cart-drawer__overlay", function () {
    $("cart-drawer").removeClass("active");
  });
});

$(document).on("click", ".slide-next-btn", function () {
  setTimeout(function () {
    $(".product-overlay").addClass("active-slide");
  }, 200);
});

$(document).on("click", ".slide-next-btn.gg-3, .slide-next-btn.gg-2", function () {
  setTimeout(function () {
    $(".product-overlay").removeClass("active-slide");
  }, 200);
});

document.addEventListener("DOMContentLoaded", function () {
  const track = document.querySelector(".product-track");
  const wrapper = document.querySelector(".product-slider");
  const delay = {{ section.settings.delay_time | default: 6 }} * 1000; // Delay in ms from customization

  // Clone slides for seamless loop
  const slides = Array.from(track.children);
  slides.forEach(slide => track.appendChild(slide.cloneNode(true)));

  let speed = 1;
  let offset = 0;
  let isPaused = false;

  wrapper.addEventListener("mouseenter", () => isPaused = true);
  wrapper.addEventListener("mouseleave", () => isPaused = false);

  function animate() {
    if (!isPaused) {
      offset -= speed;
      offset %= track.scrollWidth / 2;
      track.style.transform = `translateX(${offset}px)`;
    }
    requestAnimationFrame(animate);
  }

  // Use delay to control slider motion smoothness
  setTimeout(() => {
    animate();
  }, delay);
});
</script>
{% stylesheet %}
.product-overlay {
  position: absolute;
  bottom: 20px;
  right: 20px;
  width: 936px;
  overflow: hidden;
}
/* 
.product-slider {
  overflow: hidden;
} */

.product-overlay.active-slide {
    left: 50%;
    /* transform: translateX(-50%); */
    width: 100%;
    justify-content: center;
     transition: transform .10s ease,visibility .64s ease 
}



  .video-products-section {
    text-align: center;
  }

  .video-wrapper {
    position: relative;
    max-width: 1700px;
    margin: 0 auto;
  }

  .video-container {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
  }

  .video-container .video-bg {
    width: 100%;
    height: 700px;
    object-fit: cover;
    border-radius: 12px;
  }

   .product-overlay {
    position: absolute;
    bottom: 20px;
    right: 20px;
    display: flex;
    gap: 20px;
    /* flex-wrap: wrap; */
  } 

  .product-card {
    display: flex !important;
    align-items: center;
    background: #fff;
    padding: 10px 15px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    gap: 12px;
    min-width: 450px;
  }

  .product-image img {
    width: 60px;
    height: auto;
    border-radius: 8px;
  }

  .product-info {
    flex: 1;
  }

  .stars {
    color: #f5a623;
    font-size: 14px;
    line-height: 1;
  }

  .product-info h4 {
    font-size: 14px;
    margin: 5px 0;
  }

  .product-info .price {
    color: #2f4f2f;
    font-weight: bold;
    font-size: 14px;
  }

  .product-icons {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .product-icons img {
    width: 24px;
    height: auto;
  }

  .view-button {
    display: inline-block;
    margin-top: 20px;
    background: #0c1c13;
    color: #fff;
    padding: 12px 24px;
    border-radius: 24px;
    text-decoration: none;
  }

  .view-button:hover {
    background: #1b3a27ad;
    transition: all ease 1s;
  }
.product-overlay {
    transition: transform .64s ease, visibility .64s ease;
}



.product-slider {
  overflow: hidden;
  width: 100%;
  position: relative;
}

.product-track {
  display: flex;
  /* transition: transform 1s ease-in-out; */
  /* will-change: transform; */
}

.product-card {
  flex: 0 0 100%; /* each card takes full width */
  max-width: 100%;
}

{% endstylesheet %} 

{% schema %}
{
  "name": "Video Products home",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Application in a few simple steps"
    },
    {
      "type": "url",
      "id": "video_url",
      "label": "Video MP4 URL"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button Link"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button Label",
      "default": "View All Products"
    },
    {
      "type": "range",
      "id": "delay_time",
      "label": "Slide Delay (seconds)",
      "min": 2,
      "max": 15,
      "step": 1,
      "default": 6
    },
    {
      "type": "color",
      "id": "section_background_color",
      "label": "Section Background Color",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "heading_font_size",
      "label": "Heading Font Size (px)",
      "min": 16,
      "max": 72,
      "step": 1,
      "default": 36
    },
    {
      "type": "range",
      "id": "video_border_radius",
      "label": "Video Border Radius (px)",
      "min": 0,
      "max": 50,
      "step": 1,
      "default": 12
    },
    {
      "type": "color",
      "id": "view_button_bg_color",
      "label": "View Button Background Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "view_button_text_color",
      "label": "View Button Text Color",
      "default": "#183029"
    },
    {
      "type": "range",
      "id": "view_button_font_size",
      "label": "View Button Font Size (px)",
      "min": 10,
      "max": 28,
      "step": 1,
      "default": 20
    },
    {
      "type": "range",
      "id": "view_button_border_radius",
      "label": "View Button Border Radius (px)",
      "min": 0,
      "max": 50,
      "step": 1,
      "default": 50
    }
  ],
  "blocks": [
    {
      "type": "product_block",
      "name": "Product",
      "settings": [
        { "type": "product", "id": "product", "label": "Select Product" },
        { "type": "image_picker", "id": "icon_1", "label": "First Icon" },
        { "type": "url", "id": "icon_1_link", "label": "First Icon Link" },
        { "type": "image_picker", "id": "icon_2", "label": "Second Icon" },
        { "type": "url", "id": "icon_2_link", "label": "Second Icon Link" },
        { "type": "color", "id": "product_card_bg_color", "label": "Product Card Background Color", "default": "#ffffff" },
        { "type": "range", "id": "product_card_border_radius", "label": "Product Card Border Radius (px)", "min": 0, "max": 50, "step": 1, "default": 20 },
        { "type": "color", "id": "product_title_color", "label": "Product Title Color", "default": "#000000" },
        { "type": "range", "id": "product_title_font_size", "label": "Product Title Font Size (px)", "min": 12, "max": 36, "step": 1, "default": 20 },
        { "type": "color", "id": "price_color", "label": "Price Color", "default": "#2f4f2f" },
        { "type": "range", "id": "price_font_size", "label": "Price Font Size (px)", "min": 10, "max": 28, "step": 1, "default": 14 }
      ]
    }
  ],
  "presets": [
    { "name": "Video Products home", "category": "Custom" }
  ]
}
{% endschema %}