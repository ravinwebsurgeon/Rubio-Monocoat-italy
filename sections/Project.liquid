<div class="cust-project">
  <div class="page-width">
    <div class="cust-pro-wrap">
      <h3 class="heading-pr">{{ section.settings.heading }}</h3>

      <div class="main-pro-wrap">
        <!-- Interior / Exterior Images -->
        <div class="pro-first">
          <div class="Interio">
            {% if section.settings.img1 %}
              <img src="{{ section.settings.img1 | img_url: 'master' }}" alt="Interior">
            {% endif %}
            <div class="inter-btn" id="interior">Interior</div>
          </div>

          <div class="exterior">
            {% if section.settings.img2 %}
              <img src="{{ section.settings.img2 | img_url: 'master' }}" alt="Exterior">
            {% endif %}
            <div class="exter-btn" id="exterior">Exterior</div>
          </div>
        </div>

        <!-- Tabs + Products -->
        <div class="pro-second">
          <h3 class="heading-pr">{{ section.settings.heading2 }}</h3>
          <div class="main-tabs">

            {%- comment -%}
            Build an array of unique tab groups with their first image
            {%- endcomment -%}
            {% assign tab_groups = '' %}
            {% for b in section.blocks %}
              {% if b.settings.tab_group != blank %}
                {% unless tab_groups contains b.settings.tab_group %}
                  {% assign tab_groups = tab_groups | append: b.settings.tab_group | append: '||' | append: b.settings.tab_img | append: '%%' %}
                {% endunless %}
              {% endif %}
            {% endfor %}
            {% assign tab_items = tab_groups | split: '%%' %}

            <!-- Tabs -->
            <ul class="tabs">
              {% for item in tab_items %}
                {% assign parts = item | split: '||' %}
                {% assign tname = parts[0] %}
                {% assign timg  = parts[1] %}
                {% if tname != blank %}
                  <li data-tab="menu{{ forloop.index }}">
                    {% if timg %}
                      <img src="{{ timg | img_url: '80x' }}" alt="{{ tname | escape }}" class="tab-icon">
                    {% endif %}
                    <span>{{ tname }}</span>
                  </li>
                {% endif %}
              {% endfor %}
            </ul>

            <!-- Tab Contents -->
            {% for item in tab_items %}
              {% assign parts = item | split: '||' %}
              {% assign tname = parts[0] %}
              <div class="tab-content" id="menu{{ forloop.index }}">
                <ul class="collection-list">
                  {% for b in section.blocks %}
                    {% if b.settings.tab_group == tname and b.settings.col %}
                      {% assign the_collection = b.settings.col %}
                      {% for product in the_collection.products %}
                        <li>
                          <a href="{{ product.url }}">
                            <div class="tabbing-all-data">
                              <div class="img-col">
                                {% if product.featured_image %}
                                  <img src="{{ product.featured_image | img_url: '400x' }}" alt="{{ product.title | escape }}">
                                {% endif %}
                              </div>
                              <h3>{{ product.title }}</h3>
                              <p>{{ product.price | money }}</p>
                            </div>
                          </a>
                        </li>
                      {% endfor %}
                    {% endif %}
                  {% endfor %}
                </ul>
              </div>
            {% endfor %}

          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Project",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Main Heading",
      "default": "Choose your project:"
    },
    {
      "type": "image_picker",
      "id": "img1",
      "label": "Interior Image"
    },
    {
      "type": "image_picker",
      "id": "img2",
      "label": "Exterior Image"
    },
    {
      "type": "text",
      "id": "heading2",
      "label": "Secondary Heading",
      "default": "Choose your species:"
    }
  ],
  "blocks": [
    {
      "type": "collection_item",
      "name": "Collection Item",
      "settings": [
        {
          "type": "text",
          "id": "tab_group",
          "label": "Tab Name (group)",
          "info": "Collections with the same Tab Name appear in the same tab."
        },
        {
          "type": "image_picker",
          "id": "tab_img",
          "label": "Tab Image/Icon"
        },
        {
          "type": "collection",
          "id": "col",
          "label": "Choose Collection"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Project",
      "category": "Custom"
    }
  ]
}
{% endschema %}

<script>
document.addEventListener('DOMContentLoaded', function(){
  const firstTab = document.querySelector('.tabs li');
  const firstContent = document.querySelector('.tab-content');
  if (firstTab && firstContent) {
    firstTab.classList.add('active');
    firstContent.classList.add('active');
  }

  document.querySelectorAll('.tabs li').forEach(function(tab){
    tab.addEventListener('click', function(){
      const id = this.dataset.tab;
      document.querySelectorAll('.tabs li, .tab-content').forEach(el=>el.classList.remove('active'));
      this.classList.add('active');
      document.getElementById(id).classList.add('active');
    });
  });
});
</script>

<style>
.pro-first {
  display:flex;
  gap:50px;
}
.Interio, .exterior {
  width:50%;
  display:flex;
  flex-direction:column;
  gap:20px;
  justify-content:center;
  align-items:center;
}
.Interio img, .exterior img { width:100%; }

.inter-btn, .exter-btn {
  border-radius:50px;
  border:1px solid #000;
  padding:13px 37px;
  text-align:center;
  width:160px;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
}

h3.heading-pr {
  text-align:center;
  font-size:40px;
  font-weight:700;
}

.pro-second {
  background:#F5F5F5;
  border-radius:20px;
  padding:20px;
}

.tabs {
  display:flex;
  justify-content:center;
  margin-bottom:20px;
  gap:20px;
  list-style:none;
  padding:0;
}
.tabs li {
  cursor:pointer;
  padding:10px 20px;
  border:1px solid #000;
  border-radius:20px;
  display:flex;
  align-items:center;
  gap:10px;
}
.tabs li.active {
  background:#000;
  color:#fff;
}
.tab-icon {
  width:40px;
  height:40px;
  object-fit:cover;
  border-radius:8px;
}
.tab-content { display:none; }
.tab-content.active { display:block; }

.collection-list {
  display:flex;
  flex-wrap:wrap;
  gap:20px;
  list-style:none;
  padding:0;
}
.collection-list li { width:200px; }
.collection-list img {
  width:100%;
  border-radius:10px;
}
</style>
